<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ï–ª–µ–∫—Ç—Ä–æ–Ω–µ–Ω –¥–Ω–µ–≤–Ω–∏–∫</title>
<style>
body{margin:0;font-family:Arial;background:#f2f4f7}
header{background:#2c3e50;color:#fff;padding:15px;text-align:center;font-size:22px;word-break:break-word;}
nav{display:flex;flex-wrap:wrap;background:#34495e}
nav button{flex:1 1 50%;padding:12px;border:none;background:none;color:#fff;cursor:pointer;font-size:16px}
nav button:hover{background:#2c3e50}
.container{padding:15px}
.hidden{display:none}
.card{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1);margin-bottom:20px;overflow-x:auto}
input,textarea,select,button.action{width:100%;padding:8px;margin:6px 0;box-sizing:border-box;font-size:16px}
button.action{background:#3498db;color:#fff;border:none;padding:10px;border-radius:5px;cursor:pointer}
button.action:hover{background:#2980b9}
table{width:100%;border-collapse:collapse;margin-top:10px;table-layout:fixed;word-wrap:break-word;}
th,td{border:1px solid #ddd;padding:6px;text-align:center;vertical-align:top}
th{background:#3498db;color:#fff}
.grade{display:inline-block;padding:3px 6px;border-radius:4px;color:#fff;font-weight:bold;margin:2px;cursor:pointer;font-size:14px}
.small{text-align:left;font-size:12px;word-break:break-word;}
.avg{margin-top:4px;padding:4px;background:#ecf0f1;border-radius:4px;font-size:12px;word-break:break-word;}
.table-wrapper{overflow-x:auto;max-width:100%}
.table-wrapper table{min-width:600px;}
.subjectItem{margin:4px 0;display:flex;justify-content:space-between;align-items:center;}
.subjectItem button, .studentItem button{margin-left:10px;padding:4px 8px;font-size:14px;flex-shrink:0;}
.studentItem{margin:4px 0;display:flex;justify-content:space-between;align-items:center;}
@media (max-width:600px){
  nav button{flex:1 1 100%; font-size:18px;}
  input,textarea,select,button.action{font-size:18px;}
  .grade{font-size:16px;}
  /* 1. –ù–∞–ø—Ä–∞–≤–∏ —Ç–∞–±–ª–∏—Ü–∞—Ç–∞ –¥–∞ —Å–µ —Ä–∞–∑—Ç—è–≥–∞ –ø–æ —à–∏—Ä–∏–Ω–∞—Ç–∞ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –¥–∞ —Å–µ —Å–∫—Ä–æ–ª–∏—Ä–∞ */
.table-wrapper {
  overflow-x: auto; /* –ø–æ–∑–≤–æ–ª—è–≤–∞ —Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–Ω–æ —Å–∫—Ä–æ–ª–∏—Ä–∞–Ω–µ */
  -webkit-overflow-scrolling: touch; /* –ø–æ-–≥–ª–∞–¥–∫–æ —Å–∫—Ä–æ–ª–∏—Ä–∞–Ω–µ –Ω–∞ iOS */
}

/* 2. –¢–∞–±–ª–∏—Ü–∞—Ç–∞ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞ auto layout –≤–º–µ—Å—Ç–æ fixed */
.table-wrapper table {
  table-layout: auto; /* –∞–≤—Ç–æ —à–∏—Ä–∏–Ω–∞ –∑–∞ –∫–ª–µ—Ç–∫–∏ */
  width: 100%;        /* –∑–∞–µ–º–∞ —Ü—è–ª–∞—Ç–∞ —à–∏—Ä–∏–Ω–∞ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
}

/* 3. –ù–∞–º–∞–ª–∏ —à—Ä–∏—Ñ—Ç–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü–∞—Ç–∞ –∑–∞ –º–∞–ª–∫–∏ –µ–∫—Ä–∞–Ω–∏ */
@media (max-width: 600px) {
  table, th, td {
    font-size: 14px;
  }
}

}
</style>
</head>
<body>

<header>üìò –ï–ª–µ–∫—Ç—Ä–æ–Ω–µ–Ω —É—á–∏–ª–∏—â–µ–Ω –¥–Ω–µ–≤–Ω–∏–∫</header>

<nav>
<button onclick="show('students')">‚ûï –£—á–µ–Ω–∏–∫</button>
<button onclick="show('input')">‚úçÔ∏è –í—ä–≤–µ–∂–¥–∞–Ω–µ</button>
<button onclick="show('diary')">üìä –î–Ω–µ–≤–Ω–∏–∫</button>
<button onclick="show('program')">üìÖ –ü—Ä–æ–≥—Ä–∞–º–∞</button>
</nav>

<div class="container">

<!-- LOGIN -->
<div id="login" class="card">
  <h3>–í—Ö–æ–¥ –≤ –∞–∫–∞—É–Ω—Ç</h3>
  <input id="accountName" placeholder="–ò–º–µ –Ω–∞ –∞–∫–∞—É–Ω—Ç">
  <button class="action" onclick="login()">–í—Ö–æ–¥</button>
</div>

<!-- –£–ß–ï–ù–ò–¶–ò -->
<div id="students" class="card hidden">
<h3>–î–æ–±–∞–≤—è–Ω–µ –Ω–∞ —É—á–µ–Ω–∏–∫</h3>
<input id="newStudent" placeholder="–ò–º–µ –Ω–∞ —É—á–µ–Ω–∏–∫">
<button class="action" onclick="addStudent()">–î–æ–±–∞–≤–∏</button>
<div id="studentList"></div>
</div>

<!-- –í–™–í–ï–ñ–î–ê–ù–ï -->
<div id="input" class="card hidden">
<h3>–í—ä–≤–µ–∂–¥–∞–Ω–µ</h3>

<select id="entryType">
<option value="grade">–û—Ü–µ–Ω–∫–∞</option>
<option value="remark">–ó–∞–±–µ–ª–µ–∂–∫–∞</option>
<option value="praise">–ü–æ—Ö–≤–∞–ª–∞</option>
</select>

<input id="entryStudent" placeholder="–£—á–µ–Ω–∏–∫">
<select id="entrySubject"></select>

<div id="gradeBox">
<input id="gradeValue" type="number" min="2" max="6" placeholder="–û—Ü–µ–Ω–∫–∞">
<input id="gradeAuthor" placeholder="–û—Ç –∫–æ–≥–æ">
<input id="gradeReason" placeholder="–û—Å–Ω–æ–≤–∞–Ω–∏–µ">
</div>

<textarea id="textValue" class="hidden" placeholder="–¢–µ–∫—Å—Ç"></textarea>

<button class="action" onclick="addEntry()">–ó–∞–ø–∞–∑–∏</button>
</div>

<!-- –î–ù–ï–í–ù–ò–ö -->
<div id="diary" class="card hidden">
<h3>–î–Ω–µ–≤–Ω–∏–∫</h3>

<div class="table-wrapper">
<table>
<thead id="diaryHead"></thead>
<tbody id="diaryBody"></tbody>
</table>
</div>
</div>

<!-- –ü–†–û–ì–†–ê–ú–ê -->
<div id="program" class="card hidden">
<h3>–°–µ–¥–º–∏—á–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞</h3>

<input id="subjectName" placeholder="–ü—Ä–µ–¥–º–µ—Ç">
<input id="subjectHours" type="number" min="1" placeholder="–ß–∞—Å–∞ —Å–µ–¥–º–∏—á–Ω–æ">
<button class="action" onclick="addSubject()">–î–æ–±–∞–≤–∏ –ø—Ä–µ–¥–º–µ—Ç</button>

<div id="hoursInfo" style="margin:10px 0;font-weight:bold"></div>
<div id="subjectList"></div>

<button class="action" onclick="generateProgram()">–°—ä–∑–¥–∞–π –ø—Ä–æ–≥—Ä–∞–º–∞</button>

<table>
<thead>
<tr>
<th>–ß–∞—Å</th>
<th>–î–µ–Ω 1</th>
<th>–î–µ–Ω 2</th>
<th>–î–µ–Ω 3</th>
</tr>
</thead>
<tbody id="programTable"></tbody>
</table>
</div>

</div>

<script>
let students={}, subjects=[], currentAccount = null;

/* ---------- SHOW ---------- */
function show(id){
  if(!currentAccount) return alert("–ú–æ–ª—è, –≤–ª–µ–∑—Ç–µ –≤ –∞–∫–∞—É–Ω—Ç!");
  document.querySelectorAll('.card').forEach(c=>{
    if(c.id!=="login") c.classList.add('hidden');
  });
  document.getElementById(id).classList.remove('hidden');
  updateSubjectSelect();
  renderDiary();
  updateSubjectList();
  updateStudentList();
}

/* ---------- LOGIN ---------- */
function login(){
  let name = accountName.value.trim();
  if(!name) return alert("–í—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ –Ω–∞ –∞–∫–∞—É–Ω—Ç");
  currentAccount = name;

  let data = localStorage.getItem("diary_"+currentAccount);
  if(data){
    let obj = JSON.parse(data);
    students = obj.students || {};
    subjects = obj.subjects || [];
  } else {
    students = {};
    subjects = [];
  }

  document.getElementById("login").classList.add("hidden");
  show("students");
  saveData();
}

/* ---------- SAVE DATA ---------- */
function saveData(){
  if(!currentAccount) return;
  localStorage.setItem("diary_"+currentAccount, JSON.stringify({students, subjects}));
}

/* ---------- –£—á–µ–Ω–∏—Ü–∏ ---------- */
function addStudent(){
  let n=newStudent.value.trim();
  if(!n||students[n])return;
  students[n]={subjects:{}};
  subjects.forEach(s=>{
    students[n].subjects[s.name]={grades:[],remarks:[],praises:[]};
  });
  newStudent.value="";
  renderDiary();
  updateStudentList();
  saveData();
}

function updateStudentList(){
  studentList.innerHTML="";
  for(let st in students){
    let div=document.createElement("div");
    div.className="studentItem";
    div.textContent=st;
    let btn=document.createElement("button");
    btn.textContent="–ü—Ä–µ–º–∞—Ö–Ω–∏";
    btn.onclick=()=>{
      delete students[st];
      renderDiary();
      updateStudentList();
      saveData();
    };
    div.appendChild(btn);
    studentList.appendChild(div);
  }
}

/* ---------- –ü—Ä–µ–¥–º–µ—Ç–∏ ---------- */
function addSubject(){
  let name=subjectName.value.trim();
  let hours=parseInt(subjectHours.value);
  if(!name||hours<1)return;

  subjects.push({name,hours});
  for(let s in students){
    students[s].subjects[name]={grades:[],remarks:[],praises:[]};
  }

  subjectName.value=subjectHours.value="";
  updateSubjectSelect();
  updateSubjectList();
  updateHoursInfo();
  renderDiary();
  saveData();
}

function updateHoursInfo(){
  let total=subjects.reduce((a,b)=>a+b.hours,0);
  hoursInfo.textContent="–û–±—â–æ —á–∞—Å–æ–≤–µ: "+total;
}

function updateSubjectSelect(){
  entrySubject.innerHTML=subjects.map(s=>`<option>${s.name}</option>`).join("");
}

function updateSubjectList(){
  subjectList.innerHTML="";
  subjects.forEach((s,i)=>{
    let div=document.createElement("div");
    div.className="subjectItem";
    div.textContent=`${s.name} - ${s.hours} —á–∞—Å–∞`;
    let btn=document.createElement("button");
    btn.textContent="–ü—Ä–µ–º–∞—Ö–Ω–∏";
    btn.onclick=()=>{
      subjects.splice(i,1);
      for(let st in students){
        delete students[st].subjects[s.name];
      }
      updateSubjectSelect();
      updateSubjectList();
      renderDiary();
      saveData();
    };
    div.appendChild(btn);
    subjectList.appendChild(div);
  });
}

/* ---------- –í—ä–≤–µ–∂–¥–∞–Ω–µ ---------- */
entryType.onchange=()=>{
  gradeBox.classList.toggle("hidden",entryType.value!=="grade");
  textValue.classList.toggle("hidden",entryType.value==="grade");
};

function addEntry(){
  let st=entryStudent.value;
  let sub=entrySubject.value;
  if(!students[st])return alert("–ù—è–º–∞ —Ç–∞–∫—ä–≤ —É—á–µ–Ω–∏–∫");
  let box=students[st].subjects[sub];

  if(entryType.value==="grade"){
    box.grades.push({value:+gradeValue.value,author:gradeAuthor.value,reason:gradeReason.value});
  }else if(entryType.value==="remark"){
    box.remarks.push(textValue.value);
  }else{
    box.praises.push(textValue.value);
  }

  gradeValue.value=gradeAuthor.value=gradeReason.value=textValue.value="";
  renderDiary();
  saveData();
}

/* ---------- –î–Ω–µ–≤–Ω–∏–∫ ---------- */
function gradeColor(v){return {2:"#c0392b",3:"#e67e22",4:"#f1c40f",5:"#3498db",6:"#2ecc71"}[v];}

function showGradeInfo(g){
  alert(`–û—Ü–µ–Ω–∫–∞: ${g.value}\n–û—Ç: ${g.author}\n–û—Å–Ω–æ–≤–∞–Ω–∏–µ: ${g.reason}`);
}

function average(arr){if(arr.length===0)return "‚Äî"; return (arr.reduce((a,b)=>a+b.value,0)/arr.length).toFixed(2);}

function renderDiary(){
  diaryHead.innerHTML="";
  diaryBody.innerHTML="";
  if(subjects.length===0)return;

  let h1="<tr><th rowspan='2'>–£—á–µ–Ω–∏–∫</th>";
  subjects.forEach(s=>h1+=`<th colspan="3">${s.name}</th>`);
  h1+="</tr>";

  let h2="<tr>";
  subjects.forEach(()=>h2+="<th>–û—Ü–µ–Ω–∫–∏</th><th>–ó–∞–±–µ–ª–µ–∂–∫–∏</th><th>–ü–æ—Ö–≤–∞–ª–∏</th>");
  h2+="</tr>";

  diaryHead.innerHTML=h1+h2;

  for(let st in students){
    let row=`<tr><td><b>${st}</b></td>`;
    subjects.forEach(s=>{
      let b=students[st].subjects[s.name];
      row+=`
<td>
${b.grades.map(g=>`<span class="grade" style="background:${gradeColor(g.value)}"
onclick='showGradeInfo(${JSON.stringify(g)})'>${g.value}</span>`).join("")||"-"}
<div class="avg">–°—Ä–µ–¥–µ–Ω —É—Å–ø–µ—Ö: ${average(b.grades)}</div>
</td>

<td class="small">
<b>–ó (${b.remarks.length})</b><br>
${b.remarks.map(r=>"‚Ä¢ "+r).join("<br>")||"-"}
</td>

<td class="small">
<b>–ü (${b.praises.length})</b><br>
${b.praises.map(p=>"‚Ä¢ "+p).join("<br>")||"-"}
</td>
`;
    });
    row+="</tr>";
    diaryBody.innerHTML+=row;
  }
}

/* ---------- –ü—Ä–æ–≥—Ä–∞–º–∞ ---------- */
function generateProgram(){
  if(subjects.length===0) return alert("–î–æ–±–∞–≤–µ—Ç–µ –ø–æ–Ω–µ –µ–¥–∏–Ω –ø—Ä–µ–¥–º–µ—Ç!");
  let pool=[];
  subjects.forEach(s=>{
    for(let i=0;i<s.hours;i++) pool.push(s.name);
  });
  pool.sort(()=>Math.random()-0.5);

  programTable.innerHTML="";
  for(let h=1;h<=6;h++){
    let row=`<tr><td>${h}</td>`;
    for(let d=0;d<3;d++){
      let subj=pool.shift()||"";
      row+=`<td>${subj}</td>`;
    }
    row+="</tr>";
    programTable.innerHTML+=row;
  }
  saveData();
}

show("login");
</script>
</body>
</html>

