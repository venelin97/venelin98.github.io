<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ï–ª–µ–∫—Ç—Ä–æ–Ω–µ–Ω —É—á–∏–ª–∏—â–µ–Ω –¥–Ω–µ–≤–Ω–∏–∫</title>

<style>
body{margin:0;font-family:Arial;background:#f2f4f7;}
header{background:#2c3e50;color:white;padding:15px;text-align:center;font-size:22px;}
nav{display:flex;background:#34495e;}
nav button{flex:1;padding:12px;border:none;color:white;background:none;cursor:pointer;}
nav button:hover{background:#2c3e50;}
.hidden{display:none;}
.container{padding:15px;}
.card{background:white;padding:20px;border-radius:8px;margin-bottom:15px;}
input,select,textarea,button{width:100%;padding:8px;margin:6px 0;}
button.action{background:#3498db;color:white;border:none;}
.grade{padding:4px 6px;border-radius:4px;color:white;font-weight:bold;}
</style>
</head>

<body>

<header>üìò –ï–ª–µ–∫—Ç—Ä–æ–Ω–µ–Ω —É—á–∏–ª–∏—â–µ–Ω –¥–Ω–µ–≤–Ω–∏–∫</header>

<nav>
<button onclick="showSection('students')">–£—á–µ–Ω–∏—Ü–∏</button>
<button onclick="showSection('input')">–í—ä–≤–µ–∂–¥–∞–Ω–µ</button>
<button onclick="showSection('diary')">–î–Ω–µ–≤–Ω–∏–∫</button>
<button onclick="showSection('program')">–ü—Ä–æ–≥—Ä–∞–º–∞</button>
<button onclick="logout()">–ò–∑—Ö–æ–¥</button>
</nav>

<div class="container">

<div id="authSection" class="card">
<h3>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
<input id="authEmail" type="email" placeholder="–ò–º–µ–π–ª">
<input id="authPass" type="password" placeholder="–ü–∞—Ä–æ–ª–∞">
<button class="action" onclick="registerUser()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
<button class="action" onclick="loginUser()">–í—Ö–æ–¥</button>
</div>

<div id="students" class="card hidden">
<h3>–£—á–µ–Ω–∏—Ü–∏</h3>
<input id="newStudent" placeholder="–ò–º–µ">
<button class="action" onclick="addStudent()">–î–æ–±–∞–≤–∏</button>
<div id="studentList"></div>
</div>

<div id="input" class="card hidden">
<h3>–í—ä–≤–µ–∂–¥–∞–Ω–µ</h3>
<input id="entryStudent" placeholder="–£—á–µ–Ω–∏–∫">
<select id="entrySubject"></select>
<input id="gradeValue" type="number" placeholder="–û—Ü–µ–Ω–∫–∞ (2‚Äì6)">
<button class="action" onclick="addEntry()">–ó–∞–ø–∞–∑–∏</button>
</div>

<div id="diary" class="card hidden">
<h3>–î–Ω–µ–≤–Ω–∏–∫</h3>
<table border="1" width="100%">
<thead id="diaryHead"></thead>
<tbody id="diaryBody"></tbody>
</table>
</div>

<div id="program" class="card hidden">
<h3>–ü—Ä–æ–≥—Ä–∞–º–∞</h3>
<input id="subjectName" placeholder="–ü—Ä–µ–¥–º–µ—Ç">
<button class="action" onclick="addSubject()">–î–æ–±–∞–≤–∏ –ø—Ä–µ–¥–º–µ—Ç</button>
<ul id="programList"></ul>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";

const firebaseConfig = {
 apiKey: "AIzaSyDHYqfKhUfIYaB1IYoTGwzqSR4OSO49daw",
 authDomain: "dnevnik2-42909.firebaseapp.com",
 databaseURL: "https://dnevnik2-42909-default-rtdb.europe-west1.firebasedatabase.app",
 projectId: "dnevnik2-42909"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getDatabase();

let uid=null, students={}, subjects=[];

/* ---------- GLOBAL FUNCTIONS ---------- */
window.showSection = (id)=>{
 if(!uid && id!=='authSection') return alert("–í–ª–µ–∑ –ø—ä—Ä–≤–æ");
 document.querySelectorAll('.card').forEach(c=>c.classList.add('hidden'));
 document.getElementById(id).classList.remove('hidden');
 renderDiary();
 renderProgram();
};

window.registerUser = ()=>{
 createUserWithEmailAndPassword(auth, authEmail.value, authPass.value)
 .then(u=>{ uid=u.user.uid; save(); showSection('students'); })
 .catch(e=>alert(e.message));
};

window.loginUser = ()=>{
 signInWithEmailAndPassword(auth, authEmail.value, authPass.value)
 .then(u=>{ uid=u.user.uid; load(); showSection('students'); })
 .catch(e=>alert(e.message));
};

window.logout = ()=> signOut(auth).then(()=>location.reload());

window.addStudent = ()=>{
 students[newStudent.value]={};
 newStudent.value="";
 save(); renderDiary();
};

window.addSubject = ()=>{
 subjects.push(subjectName.value);
 subjectName.value="";
 save(); renderProgram();
};

window.addEntry = ()=>{
 students[entryStudent.value][entrySubject.value]=(gradeValue.value);
 save(); renderDiary();
};

/* ---------- DATA ---------- */
function save(){
 set(ref(db,'data/'+uid),{students,subjects});
}
function load(){
 get(ref(db,'data/'+uid)).then(s=>{
  if(s.exists()){students=s.val().students||{};subjects=s.val().subjects||[];}
 });
}

/* ---------- RENDER ---------- */
function renderDiary(){
 diaryHead.innerHTML="<tr><th>–£—á–µ–Ω–∏–∫</th>"+subjects.map(s=>`<th>${s}</th>`).join("")+"</tr>";
 diaryBody.innerHTML=Object.keys(students).map(st=>
 `<tr><td>${st}</td>`+subjects.map(s=>`<td>${students[st][s]||''}</td>`).join("")+"</tr>`
 ).join("");
}

function renderProgram(){
 programList.innerHTML=subjects.map(s=>`<li>${s}</li>`).join("");
 entrySubject.innerHTML=subjects.map(s=>`<option>${s}</option>`).join("");
}

showSection('authSection');
</script>

</body>
</html>




